---
bibliography: refs.bib
---

```{r chunk-options, include=FALSE}
source("chunk-options-paper.R")
```

## Results
### Study design and quality control
We collected single cell RNA-seq (scRNA-seq) data from three YRI iPSC lines using the Fluidigm C1 microfluidic system followed by sequencing on the Illumina HiSeq system (see Methods). 
We added ERCC spike-in controls to each sample, and used 5-bp random sequence UMIs to allow for the direct quantification of mRNA molecule numbers. 
For each of the YRI lines, we performed three independent C1 collections.
This study design (Figure 1A) allows us to estimate error and noise associated with the technical processing of the samples, independently from the biological variation between individuals.  

The three C1 replicates of each individual were collected on different dates using cell cultures of different passage numbers (Sup Table 1A). 
Thus these technical replicates additionally measure the variation from growing the cells.
Each replicate of C1 collection was accompanied by a collection of matching bulk sample using the same reagents. 
This property allowed us to globally characterize the regulatory variation between replicates of the same cell culture, as well as to estimate how well scRNA-seq data can recapitulate the RNA-seq results from population bulk samples. 

In what follows, we describe data as originating from different samples when we refer to data from distinct wells of each C1 collection. 
Generally, data from each sample correspond to data from a single cell. 
In addition, we describe data as originating from different replicates when we refer to all samples from a given C1 collection, and from different individuals when we refer to data from all replicates of a given genetically distinct iPSC line.

```{r calculate-seq-depth}
library("dplyr")
total_counts <- read.table("../data/total-counts.txt", header = TRUE,
                           sep = "\t", stringsAsFactors = FALSE)
depth_stats <- total_counts %>%
  filter(stage == "raw", well != "bulk") %>%
  group_by(individual, replicate, well) %>%
  summarize(counts_per_sample = sum(counts)) %>%
  ungroup() %>%
  summarize(mean = mean(counts_per_sample), sd = sd(counts_per_sample),
            min = min(counts_per_sample), max = max(counts_per_sample))
```

We obtained an average of `r format(depth_stats$mean / 10^6, digits = 3)` +/-
`r format(depth_stats$sd / 10^6, digits = 3)` million sequencing reads per sample
(range `r format(depth_stats$min / 10^6, digits = 3)`-`r format(depth_stats$max / 10^6, digits = 3)` million reads).
We processed the sequencing reads using a standard alignment approach (see Methods). 
Given the low abundance of mRNA content and the high vulnerability of single cells and the low amount of starting material, scRNA-seq can be highly affected by various technical artifacts arising from cell isolation, mRNA capture efficiency, library preparation, and sequencing procedures. 
We thus performed multiple quality control analyses.

As a first step, we estimated the proportion of ERCC spike-in reads from each sample. 
We found that, across samples, sequencing reads from the second replicate of individual 19098 include unusually high ERCC content compared to all other samples and replicates (Sup Figure. 2A and B). 
We concluded that a pipetting error led to excess ERCC content in this replicate and we excluded the data from all samples of this replicate in subsequent analyses.

With the exception of the excluded samples, data from all other replicates seem to have similar global properties (using general metrics; Sup figure 2X). 
We therefore proceeded by focusing on the assumption that data from each sample correspond to data from an individual cell. 
Before the processing of the individual cell samples, we performed visual inspection on the C1 microfluidic plates (see Methods). 
Based on that visual inspection, we have excluded sequencing data from 21 samples that did not contain any cell, and 54 samples that contained more than one cell (across all replicates). 
We then filtered data from the remaining samples based on the the number of total mapped reads, the percentage of unmapped reads, the percentage of ERCC spike-in reads, and the number of genes detected (Sup Figure 2).
We used data-driven inclusion cutoffs for each metric, based on the 95th percentile of the distribution for the 21 libraries that were amplified from samples that did not include a cell based on visual inspection (Figure. 1B-E and Sup Figure. 2C-F). 

Visual inspection of the C1 microfluidic plate is an important quality control step, but it is not infallible.
We thus identified and removed data from 15 additional samples that were classified as originating from a single cell based on visual inspection, but whose data were more consistent with a multiple-cell origin based on the number of total molecules, the concentration of cDNA amplicons, and the read-to-molecule conversion efficiency (defined as the number of total molecules divided by the number of total reads; Sup Figure 3). 
At the conclusion of these quality control analyses and exclusion steps, we retained data from 564 high quality samples, which correspond, with reasonable confidence, to 564 single cells, across eight replicates from three individuals (Table 1).

Our final quality check focused on the different properties of sequencing read and molecule count data.
We considered data from the 564 high quality samples and compared gene specific counts of sequencing read and molecules.
We found that while gene-specific read and molecule counts are exceptionally highly correlated when we considered the ERCC spike-in data (r = 0.99; Figure. 1G), these counts are somewhat less correlated when data from the endogenous genes are considered (r = 0.92). 
Moreover, the gene-specific read and molecule counts correlation is noticeably lower for genes that are expressed at lower levels. These observations concur with previous studies [@Brennecke2013] as they underscore the importance of using UMIs in single cell gene expression studies.

Beyond quality control of the samples, we also estimated the number of molecule counts required for representing the bulk samples and also for capturing the cell-to-cell variation in gene expression. 
To this end, we conducted a systematic subsampling at the levels of sequencing depth, including both read and molecule counts, along with the consideration of cell numbers, using our high quality samples (Figure. 2).
The results showed that sequencing depth of 2 million reads, which corresponds to ~100,000 molecule counts, with 75 single cell samples is sufficient to capture the majority of genes expressed (~90 %, Figure. 2A), as well as to accurately reflect mean expression levels in the whole cell culture (r > 0.93, Figure. 2B). 
More importantly, we found that the cell-cell variance from the same subsampling cutoffs can also accurately represent all the collected single cell samples (r > 0.95, Figure. 2C).

### Is there a need to standardize molecule-counts?  
Standard analysis of single cell gene expression data often relies on the implicit assumption that molecule-count data, collected by using single cell UMI-based approaches, can be thought of as an absolute estimate of the total number of RNA molecules in the cell [@Islam2014]. 
In other words, differences in total molecule-counts across cells may indicate differences in the amount of RNA content between cells, which generally correspond to differences in cell size when all cells are of the same type [@Padovan-Merhar2015].
To verify this common notion, we considered the correlation between sample concentrations (measured at the library stage; see Methods) and total molecule-counts (range from 30408 to 113832; Sup. Figure. 4A), across all detected endogenous genes. 
Indeed, we found a general correlation between total molecule-counts in single cells and the measured sample concentration (Sup. Figure. 4B).
Yet, we also observed that the relationship between total molecule-counts and concentration is significantly different across C1 collection replicates from the same individual (range of correlation between -0.038 and 0.816; F-test; p < 0.001 in individual 19239), and more so across single cell collections from different individuals (range of correlation between 0.277 and 0.816; F-test; p < 0.001). 

We investigated this property further by classifying the cell cycle phase of single cells based on their gene expression profiles using standardized molecule counts [@Macosko2015]. 
We then considered the association between cell cycle phase and total molecule-counts. It is expected that cells that are in G2 and G2/M phases would have higher total molecule-counts [@Vallejos2015], which is indeed our general observation. 
However, variation in this pattern can clearly be seen across single cell collections from different individuals, as well as across different C1 collection replicates from the same individual (Sup. Figure 5). 

Our study design allows us to carefully examine the difference of molecule-counts across C1 replicates and also individuals by analyzing the molecule counts of ERCC spike-in controls.
In the absence of technical noise, the total ERCC molecule-counts per sample is the same, not affected by the total endogenous gene molecule-counts or the percentage of ERCC molecules among all molecules (Sup. Figure. 4C and 4D, respectively).
However, we observed a clear differences across the three individuals (F-test, p < 0.001) and also across C1 replicates of the same individuals (F-test, p < 0.001 in individual 19098 and 19101), suggesting that some unidentified factors inherent from the individual difference to the distribution of gene expression in the single cells is consistently affecting the molecule-counts.

Whether or not molecule-counts can be used as an absolute estimate of a given gene in a cell is dependent on one critical factor: the sequencing saturation point, at which all the molecules are sequenced at least once. 
In any given cell, if the sequencing depth is far from being saturated, the possibility that a "new" molecule will be picked up would be significantly higher compared to the sequencing depth that is closer to the saturation point.
As a result, the total number of molecule counts would elevated as the sequencing depth increases, which is in fact what we observed in our data (Figure. 3A and 3C).
With the attempt to search for a sequencing saturation point of the protocol, we collected scRNA-seq data from four individual cells using all the available library materials (Sup Figure. 6).
At the sequencing depth of 50 million reads per cell, the numbers of endogenous genes started to plateau (Sup Figure. 6A and B), whereas the total molecule counts were still increasing (Sup Figure. 6D and F), suggesting that we have not yet reach the saturation point.

Taken together, we concluded that molecule-counts cannot be used as an absolute number of mRNA, and more importantly, standardization of molecule-counts is required to eliminate the effect of sequencing depth, the cell-to-cell difference arose from biological heterogeneity such as cell-cycle phase, and also the difference of total molecule-counts across individuals.

### Is there a batch effect associated with UMI-based single cell data using C1 platform?
It is reasonable to assume that batch effects impact single cell gene expression data. 
In the context of the C1 system, if a study measures single cell gene expression with one C1 plate per biological condition, it would be impossible to differentiate between the true biological conditions and any technical effects associated with the independent capturing and sequencing of each C1 batch. 
We designed our study with multiple technical replicates per biological condition in order to directly and explicitly estimate the batch effect associated with independent C1 preparations.

As a first step in exploring noise in scRNA-seq data collected from C1 system, we examined the gene expression across all quality single cells using raw molecule counts (Figure. 4A).
We found that single cell samples were separated by individuals, despite that individual 19239 might be dissimilar from the other two individuals.
Not surprisingly, the separation of different replicates from the same individual was also substantial (Figure. 4A).

As described previously, we also explored batch effect of total molecule-counts per single cell sample.
The analyses of the total molecule-counts showed that its relationships with sample concentration (Sup. Figure. 4B), as well as with the cell cycle pattern (Sup. Figure. 5), are different across individuals and also across C1 replicates of the same individual, providing the indication that technical effects significantly impact the results of single cell gene expression data.

To explore this further, we asked if the conversion of read counts to molecule counts is inconsistent across single cell samples, and may therefore play a role in generating technical variation of total molecule-counts.
For quantification purpose, we defined read-to-molecule conversion efficiency as the total molecule-counts divided by the total reads-counts of endogenous genes or ERCC spike-ins in each sample.
Against the common intuition, we observed a batch effect arising from the difference of read-to-molecule conversion efficiency across C1 replicates of individuals 19101 (p< 0.001) and 19239 (p< 0.001, Figure. 3B). 
In addition, the difference of read-to-molecule conversion efficiency across the three individuals was significant not only in endogenous genes but also in the ERCC spike-ins (p< 0.001, Figure. 3D), suggesting that differences in certain unknown biological factors across these individuals are affecting the conversion efficiency of both ERCC spike-ins and endogenous genes in single cells.

Put together, the analyses of the gene expression using molecule counts and also the associations of total molecule-counts all demonstrate that batch effect across C1 replicates is a critical systematic error of scRNA-seq data while using UMI-based approach and C1 platform. 

### A novel normalization method for UMI-based scRNA-seq data analysis 
To remove the technical variability arose from the factors mentioned above, here, we developed a pipeline that is applicable for studying cell-to-cell variation of gene expression from multiple biological conditions with multiple C1 collections (Figure. 4). 

Using the UMI approach, we are able to more accurately estimate relative molecule counts of each genes within a single cell sample (Sup Figure. X).  
However, due to the stochasticity of the UMI labeling process, not all molecules will be tagged with an unique UMI and sequenced.
To account for the effect of random counting statistics termed collision probability, we first computed the raw molecule number of each endogenous gene by applying a mathematical correction [@Fu2011]. 
Essentially, we are correcting for the fact that we did not observe all the molecules of any given gene originally in the cell.
This step also filtered the genes with molecule counts larger than 1024, which in our case were all mitochondrial genes (data not shown). 

As described previously, there is a need to standardize the molecule-counts of endogenous genes to remove the effect of different sequencing depth, as well as the difference in total mRNA content because of cell-cell variation.  
We thus incorporated a standardization step by computing log transformed counts-per-million (cpm) of molecule counts.
This method takes the total molecule-counts per sample into account and makes them equal, a total of one million counts, across all samples. 
After the removal of the variance caused by total molecule-counts, the difference between C1 replicates, or the batch effect, became dominant (Figure. 4A and 4B).

To carefully account for the cell-to-cell technical variability arising from the differences of mRNA capture efficiency across samples within the C1 collection, we next performed Poisson GLM (generalized linear model) normalization using the observed and the expected molecule counts of ERCC spike-ins, without correction for collision probability and also without standardization, in each sample.
The PCA of gene expression after normalization showed that PC1 and PC2 separated not only the three individuals but also the three C1 replicates of each individual, suggesting that the batch effects from the C1 replicates were yet to be removed (Figure. 4C).

To directly remove unwanted technical variation across C1 replicates, we modeled between well correlation in gene expression within C1 replicate. 
We assumed that C1 plates share similar technical variation due to gene expression similarity between cells on the same plate. 
The results of PCA on the corrected data showed that the samples from different C1 replicates of the same individual largely overlapped (Figure. 4D), indicating that we have successfully removed large proportion of the unwanted technical variation across C1 replicates. 

### Quantitatively measure the cell-to-cell variation of gene expression
The term “gene expression noise or stochasticity” is typically used to describe variation in protein expression levels caused by the intrinsically stochastic nature of molecular interactions that underlie transcription, translation and post-translational regulation within isogenic cell populations [@Raj2008; @Lestas2010]. 
In a more general sense, expression noise also refers to cell-to-cell variation in the abundance of mRNAs, given that variability in protein content is generally a consequence of infrequent transitions between active and inactive promoter states [@Blake2003; @Raser2004].
Once we removed the unwanted technical variability from scRNA-seq data as described above, we next focused on analyzing cell-to-cell variation of gene expression.
We first investigated the biological gene expression variability, or gene expression noise, across single cell samples of each individual, and then we identified the genes that present differential expression noise across the three individuals.

#### Using adjusted CV value as the measure of expression noise
Examining endogenous transcriptional variability in iPSCs as a function of RNA abundance across C1 replicates, we found that coefficient of variation (CV) of molecule counts among endogenous genes and ERCC spike-in genes suggested similar expression variability patterns that track the expected Poisson distribution (Sup Figure. 8A), which are consistent with previous studies of mouse ESCs (embryonic stem cells) [@Islam2014; @Brennecke2013]. 
Due to the observation that transcriptional variability was correlated with mean gene abundance, we adjusted our gene variability measure (CV) by gene abundance averaged across single cells (see the Methods section, Sup Figure. 8B), a similar method used to investigate gene expression noise in mouse ESCs [@Kolodziejczyk2015]. 
To investigate the effect of the unobserved measurements, or the dropouts, we separately measured the CVs with or without the cells where a given gene was not detected/expressed [@Shalek2013]. 
While including only the expressed cells - cells that were quantified by one or more molecule counts of the given gene, we found that 887 genes were ranked among the top 1,000 highly expressed genes in all three individuals (Figure. 5A), whereas 103 genes were ranked among the top 1,000 noisy genes (Figure. 5B).
Similar results were found when all quality single cells were included that the three individuals shared 891 highly expressed genes and 120 highly noisy genes (data not shown), indicating the presence of differential cell-to-cell variation in gene expression across individuals.

We also looked at the proportion of undetected cells, or the dropout rate, of each gene and its association with gene abundance and gene expression noise (Figure. 5C and 5D).
We found that the proportion of undetected cells varied between genes, with the median ranged between 21 to 30 percent in the three individuals.
Significant individual difference in the proportion of undetected genes were found in more than 10 percent of the genes (1,958 genes).
As expected, gene abundance and variance of the expressed cells were associated with the proportion of undetected cells (Sup. Figure. 9A and 9B, respectively). 
However, importantly, the variability measure CV was not associated with proportion of undetected cells (Spearman's correlation = .04) across the three individuals (Sup. Figure. 9C), supporting the idea that CV is not confounded with the dynamic range of gene abundance. 

#### Identification of genes with differential gene expression noise across individuals
Next, we identified differential noisy genes across individuals using the median of absolute deviation (MAD) to quantify the degree of dissimilarity between individual noise measures. 
While only the expressed cells were included for computing individual CVs adjusted by gene abundance, our permutation-based test indicated that 330 genes had statistically significant differences in gene expression noise between individuals, at an alpha-level of $10^{-5}$ (Sup Table. X of gene list, Sup. Figure. 10). 
Enrichment analysis suggested that these genes were enriched for genes involved in protein translation, protein disassembly, and various biosynthetic processes (Sup Table. X). 
We found two highly expressed pluripotency genes *DNMT3B* and *NR6A1* among the differential noisy genes, both of which were detected in all single cells (Sup. Figure. 10), whereas the majority of the pluripotency genes were not detected in all the cells and exhibited no differential noisy pattern, including key pluripotency genes *Nanog* and *ZFP42* (Sup. Figure. 11), suggesting that the pluripotent state was tightly regulated.
Furthermore, the transcriptional noise variation exhibited a few interesting patterns across individuals, such as proportion and expression variability of the expressed cells, and also the proportion of undetected cells (dropout rate, Figure. 6).
For instance, *TFPI* and *Nanog* in individual NA19101 exhibited a higher number of expressed cells and also a wider range of expression among the expressed cells compared to the other two individuals, yet the difference of adjusted CV of *Nanog* was not significant across individuals (*p* = 0.80).
On the other hand, *SLC25A16* exhibited a similar range of variation in the expressed cells across the three individuals, but the number of expressed cells was different, and the difference of adjusted CV was significant. 
Most importantly, despite the association between gene abundance and proportion of undetected genes (Figure. 5D), we found no associations between the individual differences, and similarly for individual differences in expression noise and proportion of undetected genes (Figure. 6).


